function hotcoffee_init_reviews(e){"use strict";e.find(".reviews_editable .reviews_slider:not(.inited)").each(function(){if(void 0!==HOTCOFFEE_STORAGE.reviews_allow_user_marks&&HOTCOFFEE_STORAGE.reviews_allow_user_marks&&!(jQuery(this).parents("div:hidden,article:hidden").length>0)){jQuery(this).addClass("inited");var e=jQuery(this).parents(".reviews_item"),i=jQuery(this).parents(".reviews_stars_wrap"),r=parseInt(e.data("max-level"),10),t=parseFloat(e.data("step")),s=Math.pow(10,t.toString().indexOf(".")<0?0:t.toString().length-t.toString().indexOf(".")-1),a=Math.max(1,(i.width()-jQuery(this).width())/(r-0)/s),_=parseFloat(e.find('input[type="hidden"]').val()),n=Math.round((_-0)*(i.width()-jQuery(this).width())/(r-0));hotcoffee_reviews_set_current_mark(e,_,n,!1),jQuery(this).draggable({axis:"x",grid:[a,a],containment:".reviews_stars_wrap",scroll:!1,drag:function(t,a){var _=a.position.left>=0?a.position.left:a.originalPosition.left+a.offset.left,n=Math.min(r,Math.max(0,Math.round(_*s*(r-0)/(i.width()-jQuery(this).width()))/s+0));hotcoffee_reviews_set_current_mark(e,n)}})}}),e.find(".reviews_editor .reviews_editable .reviews_stars_wrap:not(.inited),.reviews_editor .reviews_max_level_100 .reviews_criteria:not(.inited)").each(function(){jQuery(this).parents("div:hidden,article:hidden").length>0||jQuery(this).addClass("inited").on("click",function(e){if(void 0!==HOTCOFFEE_STORAGE.reviews_allow_user_marks&&HOTCOFFEE_STORAGE.reviews_allow_user_marks&&(!jQuery(this).hasClass("reviews_criteria")||jQuery(this).next().hasClass("reviews_editable"))){var i=jQuery(this).hasClass("reviews_criteria")?jQuery(this).next():jQuery(this),r=i.parents(".reviews_item"),t=i.width()-i.find(".reviews_slider").width(),s=parseInt(r.data("max-level"),10),a=parseFloat(r.data("step")),_=Math.pow(10,a.toString().indexOf(".")<0?0:a.toString().length-a.toString().indexOf(".")-1),n=e.pageX-i.offset().left;n<=1&&(n=0),n>t&&(n=t),hotcoffee_reviews_set_current_mark(r,Math.min(s,Math.max(0,Math.round(n*_*(s-0)/t)/_+0)),n)}})}),e.find(".reviews_accept:not(.inited)").each(function(){jQuery(this).parents("div:hidden,article:hidden").length>0||jQuery(this).addClass("inited").on("click","a",function(e){if(void 0!==HOTCOFFEE_STORAGE.reviews_allow_user_marks&&HOTCOFFEE_STORAGE.reviews_allow_user_marks){var i=0,r=0,t=jQuery(this).parents(".reviews_accept"),s=t.siblings(".reviews_editor");return s.find('input[type="hidden"]').each(function(e){var t=jQuery(this).parents(".reviews_item"),s=parseFloat(t.data("step")),a=Math.pow(10,s.toString().indexOf(".")<0?0:s.toString().length-s.toString().indexOf(".")-1),_=parseFloat(jQuery(this).val());isNaN(_)&&(_=0),HOTCOFFEE_STORAGE.reviews_marks[e]=Math.round(((HOTCOFFEE_STORAGE.reviews_marks.length>e&&""!=HOTCOFFEE_STORAGE.reviews_marks[e]?parseFloat(HOTCOFFEE_STORAGE.reviews_marks[e])*HOTCOFFEE_STORAGE.reviews_users:0)+_)/(HOTCOFFEE_STORAGE.reviews_users+1)*a)/a,jQuery(this).val(HOTCOFFEE_STORAGE.reviews_marks[e]),i++,r+=_}),r>0&&(HOTCOFFEE_STORAGE.reviews_marks.length>i&&(HOTCOFFEE_STORAGE.reviews_marks=HOTCOFFEE_STORAGE.reviews_marks.splice(i,HOTCOFFEE_STORAGE.reviews_marks.length-i)),HOTCOFFEE_STORAGE.reviews_users++,t.fadeOut(),jQuery.post(HOTCOFFEE_STORAGE.ajax_url,{action:"reviews_users_accept",nonce:HOTCOFFEE_STORAGE.ajax_nonce,post_id:HOTCOFFEE_STORAGE.post_id,marks:HOTCOFFEE_STORAGE.reviews_marks.join(","),users:HOTCOFFEE_STORAGE.reviews_users}).done(function(e){var i={};try{i=JSON.parse(e)}catch(r){i={error:HOTCOFFEE_STORAGE.ajax_error},console.log(e)}""===i.error?(HOTCOFFEE_STORAGE.reviews_allow_user_marks=!1,hotcoffee_set_cookie("hotcoffee_votes",HOTCOFFEE_STORAGE.reviews_vote+(","!=HOTCOFFEE_STORAGE.reviews_vote.substr(-1)?",":"")+HOTCOFFEE_STORAGE.post_id+",",365),s.find(".reviews_item").each(function(e){jQuery(this).data("mark",HOTCOFFEE_STORAGE.reviews_marks[e]).find('input[type="hidden"]').val(HOTCOFFEE_STORAGE.reviews_marks[e]).end().find(".reviews_value").html(HOTCOFFEE_STORAGE.reviews_marks[e]).end().find(".reviews_stars_hover").css("width",Math.round(HOTCOFFEE_STORAGE.reviews_marks[e]/HOTCOFFEE_STORAGE.reviews_max_level*100)+"%")}),hotcoffee_reviews_set_average_mark(s),s.find(".reviews_stars").removeClass("reviews_editable"),s.siblings(".reviews_summary").find(".reviews_criteria").html(HOTCOFFEE_STORAGE.strings.reviews_vote)):s.siblings(".reviews_summary").find(".reviews_criteria").html(HOTCOFFEE_STORAGE.strings.reviews_error)})),e.preventDefault(),!1}})})}function hotcoffee_reviews_set_current_mark(e,i){"use strict";var r=null!=arguments[2]?arguments[2]:-1,t=null==arguments[3]||arguments[3],s=parseInt(e.data("max-level"),10);e.find(".reviews_value").html(i),e.find('input[type="hidden"]').val(i).trigger("change"),e.find(".reviews_stars_hover").css("width",Math.round(e.find(".reviews_stars_bg").width()*i/(s-0))+"px"),r>=0&&e.find(".reviews_slider").css("left",r+"px"),HOTCOFFEE_STORAGE.admin_mode||HOTCOFFEE_STORAGE.reviews_user_accepted||!t||(HOTCOFFEE_STORAGE.reviews_user_accepted=!0,e.siblings(".reviews_item").each(function(){jQuery(this).find(".reviews_stars_hover").css("width",0),jQuery(this).find(".reviews_value").html("0"),jQuery(this).find(".reviews_slider").css("left",0),jQuery(this).find('input[type="hidden"]').val("0")}),e.parent().next().fadeIn()),hotcoffee_reviews_set_average_mark(e.parents(".reviews_editor"))}function hotcoffee_reviews_set_average_mark(e){"use strict";var i=0,r=0,t=parseInt(e.find(".reviews_item").eq(0).data("max-level"),10),s=parseFloat(e.find(".reviews_item").eq(0).data("step")),a=Math.pow(10,s.toString().indexOf(".")<0?0:s.toString().length-s.toString().indexOf(".")-1);e.find('input[type="hidden"]').each(function(){i+=parseFloat(jQuery(this).val()),r++}),i=r>0?i/r:0,i=Math.min(t,Math.max(0,Math.round(i*a)/a+0));var _=e.siblings(".reviews_summary");_.find(".reviews_value").html(i),_.find('input[type="hidden"]').val(i).trigger("change"),_.find(".reviews_stars_hover").css("width",Math.round(_.find(".reviews_stars_bg").width()*i/(t-0))+"px")}function hotcoffee_reviews_marks_to_display(e){"use strict";return HOTCOFFEE_STORAGE.reviews_max_level<100&&(e=Math.round(e/100*HOTCOFFEE_STORAGE.reviews_max_level*10)/10,String(e).indexOf(".")<0&&(e+=".0")),e}function hotcoffee_reviews_get_word_value(e){"use strict";var i=HOTCOFFEE_STORAGE.reviews_levels.split(","),r=HOTCOFFEE_STORAGE.reviews_max_level/i.length;return i[e=Math.max(0,Math.min(i.length-1,Math.floor(e/r)))]}jQuery(window).on("load",function(){"use strict";HOTCOFFEE_STORAGE.reviews_user_accepted=!1,hotcoffee_add_hidden_elements_handler("init_reviews",hotcoffee_init_reviews),hotcoffee_init_reviews(jQuery("body"))});